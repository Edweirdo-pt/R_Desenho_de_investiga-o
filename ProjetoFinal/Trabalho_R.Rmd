---
title: "Trabalho_R"
output: html_document
---
\begin{titlepage}
\centering

% Título maior
\vspace*{1cm}
{\Huge \textbf{Trabalho Final}\\[0.3cm]
\Large \textbf{Desenho de Investigação em Organizações de Saúde}}

% Ajustar posição da imagem para o meio
\vspace{3.5cm}
\includegraphics[width=0.45\textwidth]{logo.png}
\vspace{3cm}

% Empurrar nomes para baixo
\vfill

% Nomes no canto inferior direito
\raggedleft
{\large
Eduardo Figueira, n.º 2025127\\
João Gonçalves, n.º 2025129
}

\vspace{0.8cm}

% Data centrada no fundo
\begin{center}
{\large 2025/2026}
\end{center}

\end{titlepage}

\newpage


```{r setup, include=FALSE}
# Criação da base de dados, de forma aleatória, a partir da BD "healthcare_dataset.csv"
# Configurações globais: echo=TRUE garante que o código  aparece no PDF.
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(ggplot2)

# Leitura da base de dados
dados <- read.csv("healthcare_dataset.csv", stringsAsFactors = FALSE)

# Conversão de tipos para garantir que não existem erros.
dados$Date.of.Admission <- as.Date(dados$Date.of.Admission)
dados$Discharge.Date <- as.Date(dados$Discharge.Date)

# Variáveis Qualitativas (Factors).
cols_factor <- c("Gender", "Blood.Type", "Medical.Condition", "Doctor", 
                 "Hospital", "Insurance.Provider", "Admission.Type", 
                 "Medication", "Test.Results")
dados[cols_factor] <- lapply(dados[cols_factor], factor)

# Variáveis Quantitativas.
dados$Age <- as.numeric(dados$Age)
dados$Billing.Amount <- as.numeric(dados$Billing.Amount)

# Fixa a semente para que a "aleatoriedade" seja sempre igual cada vez que se corre o código.
set.seed(123)

# Calcula o número total de registos na base original.
n_total <- nrow(dados)
n_total


# Gera UM número aleatório entre 0.50 e 0.65 (corresponde a 50% a 65% da base).
p <- runif(1, min = 0.50, max = 0.65)

# Calcula quantos registos a amostra deve ter (arredonda para baixo com função floor).
n_amostra <- floor(p * n_total)

# Seleciona aleatoriamente os índices (as linhas) sem repetição.
indices <- sample(seq_len(n_total), size = n_amostra, replace = FALSE)

# Cria o novo dataframe 'amostra' apenas com as linhas selecionadas.
amostra <- dados[indices, ]
summary(amostra)
# Guarda a amostra gerada num novo ficheiro CSV na mesma pasta onde o projeto está.
write.csv(amostra, "healthcare_dataset_sample.csv", row.names = FALSE)
```

# Pergunta 1 – Classificação das Variáveis

Nesta etapa, procedeu-se à classificação técnica de todas as variáveis presentes na base de dados, identificando a sua natureza e a respetiva escala de medição. Esta classificação é fundamental para selecionar os métodos estatísticos e as representações gráficas mais adequadas.

| Variável | Tipo de Variável | Escala de Medição |
| :--- | :--- | :--- |
| **Name** | Qualitativa Nominal | Nominal |
| **Age** | Quantitativa Discreta | Razão |
| **Gender** | Qualitativa Nominal | Nominal |
| **Blood Type** | Qualitativa Nominal | Nominal |
| **Medical Condition** | Qualitativa Nominal | Nominal |
| **Date of Admission** | Quantitativa Discreta (temporal) | Intervalo |
| **Doctor / Hospital** | Qualitativa Nominal | Nominal |
| **Insurance Provider** | Qualitativa Nominal | Nominal |
| **Billing Amount** | Quantitativa Contínua | Razão |
| **Room Number** | Qualitativa Nominal | Nominal |
| **Admission Type** | Qualitativa Nominal | Nominal |
| **Discharge Date** | Quantitativa Discreta (temporal) | Intervalo |
| **Medication** | Qualitativa Nominal | Nominal |
| **Test Results** | Qualitativa Nominal | Nominal |


# Pergunta 2.Caracterize as variáveis Age, Gender, Blood.Type, Medical.Condition, recorrendo a gráficos e/ou estatísticas descritivas de acordo com as características das variáveis. 

*2.1 "Age"*

**Classificação:** Variável Quantitativa Contínua, medida numa escala de razão.

**Justificação:** Por se tratar de uma variável quantitativa contínua, a sua caracterização baseia-se em medidas de tendência central e de dispersão. O histograma permite observar a forma geral da distribuição, enquanto o boxplot possibilita a identificação de valores extremos e a análise da dispersão.

```{r echo=FALSE}
# Estatísticas Descritivas
print('Medidas de tendencia central:')
summary(amostra$Age)
print('Desvio padrão:') 
sd(amostra$Age) 


# Gráficos
par(mfrow=c(1,2)) # Divide a moldura em 1 linha e 2 colunas
hist(amostra$Age, main= "" , xlab="Idade",ylab = "Frequência", col="lightblue", border="white")

# Legenda do Gráfico 1
mtext(expression(bold("Gráfico 1 – ") * 'Histograma da variável "Age"'),
      side = 1, line = 4)

boxplot(amostra$Age, main="", ylab="Idade", col="lightblue")

# Legenda do Gráfico 2
mtext(expression(bold("Gráfico 2 – ") * 'Boxplot da variável "Age"'),
      side = 1, line = 4)

```

**Exploração** A idade dos pacientes apresenta uma distribuição relativamente equilibrada, com média próxima da mediana. O histograma sugere uma distribuição aproximadamente simétrica, enquanto o boxplot não evidencia a presença de outliers relevantes. Estes resultados indicam uma amostra etariamente diversificada, sem casos extremos que influenciem significativamente as medidas centrais.

*2.2 "Gender"*

**Classificação:** Variável Qualitativa Nominal (dicotómica).

**Justificação:** Por se tratar de uma variável categórica sem ordem, a sua caracterização baseia-se na análise de frequências absolutas e relativas. O gráfico de barras é a representação mais adequada para comparar as proporções entre as duas categorias e avaliar o equilíbrio da amostra.

```{r echo=FALSE}
# 1. Obter frequências absolutas e relativas
genero_abs <- table(amostra$Gender)
genero_rel <- prop.table(genero_abs) * 100

# 2. Criar o gráfico de barras
bar_pos <- barplot(genero_rel, 
                   main = "",
                   ylab = "Percentagem (%)",
                   col = c("steelblue", "coral"),
                   ylim = c(0, 70),
                   border = "white")

# 3. Adicionar a linha de equilíbrio nos 50%
abline(h = 50, col = "red", lty = 2)

# 4. Criar as etiquetas: "Percentagem% (n=Valor)"
etiquetas <- paste0(round(genero_rel, 1), "% \n (n=", genero_abs, ")")

# 5. Colocar as etiquetas no topo das barras
text(x = bar_pos, 
     y = genero_rel, 
     labels = etiquetas, 
     pos = 3,       # Coloca acima da coordenada Y
     cex = 0.9,     # Tamanho da fonte
     font = 2)      # Negrito

# 6. Colocar Legenda no Gráfico
mtext(expression(bold("Gráfico 3 – ") * "Distribuição por Sexo (Frequência e %)"),
      side = 1, line = 4)

```

**Exploração** A amostra é constituída por 2735 pacientes do sexo feminino (50.4%) e 2696 do sexo masculino (49.6%). A proximidade entre as frequências relativas das duas categorias indica uma distribuição equilibrada, não se observando predominância relevante de um dos sexos.

*2.3 "Blood.Type"*

**Classificação:** Variável Qualitativa Nominal (Politómica).

**Justificação:** Por se tratar de uma variável categórica sem ordem, a sua caracterização baseia-se na análise de frequências absolutas e relativas. Recorreu-se a um gráfico de barras ordenado, permitindo uma comparação visual direta entre as frequências dos diferentes grupos sanguíneos e a identificação da categoria mais prevalente.


```{r echo=FALSE}
# 1. Preparar dados
blood_tab <- table(amostra$Blood.Type)
blood_tab_sorted <- sort(blood_tab, decreasing = TRUE)
blood_perc <- prop.table(blood_tab_sorted) * 100

# 2. Criar o gráfico
# Aumentamos o ylim para o texto não ser cortado
bp_blood <- barplot(blood_perc, 
                    main = "",
                    col = "lightsteelblue", 
                    ylim = c(0, max(blood_perc) + 8), 
                    las = 1, 
                    border = "white",
                    ylab = "Percentagem (%)")

# 3. Criar etiquetas formatadas
txt_blood <- paste0(round(blood_perc, 1), "%\n(n=", blood_tab_sorted, ")")

# 4. Adicionar texto por cima das barras
text(x = bp_blood, 
     y = blood_perc, 
     labels = txt_blood, 
     pos = 3, 
     cex = 0.8, 
     font = 2)

# 5. Colocar Legenda no Gráfico
mtext(expression(bold("Gráfico 4 – ") * "Prevalência da amostra por Grupo Sanguíneo"),
      side = 1, line = 4)

```

**Exploração** A variável apresenta oito categorias distintas correspondentes aos diferentes grupos sanguíneos. O grupo O+ é o mais frequente na amostra, com 698 pacientes (12.9%), enquanto o grupo O− apresenta a menor frequência, com 643 pacientes (11.8%). As frequências relativas dos diferentes grupos são próximas entre si, não se observando uma predominância marcada de um grupo sanguíneo face aos restantes.

*2.4 "Medical.Condition"*

**Classificação:** Variável Qualitativa Nominal

**Justificação:** Recorreu-se a um gráfico de barras horizontal, que permite uma leitura clara das diferentes patologias, evita a sobreposição de texto e, através da ordenação decrescente, facilita a comparação da prevalência entre as várias condições clínicas.

```{r echo=FALSE}
# 1. Preparar dados
med_tab <- sort(table(amostra$Medical.Condition), decreasing = TRUE)
med_perc <- prop.table(med_tab) * 100

# 2. Inverter para o gráfico horizontal 
med_tab_plot <- rev(med_tab)
med_perc_plot <- rev(med_perc)

# 3. Ajustar margens 
par(mar = c(5, 10, 4, 2)) 

# 4. Gráfico Horizontal
bp_med <- barplot(med_perc_plot, 
                  horiz = TRUE, 
                  las = 1, 
                  main = "",
                  col = "indianred1",
                  xlim = c(0, max(med_perc_plot) + 10),
                  border = "white",
                  cex.names = 0.8)

# 5. Adicionar etiquetas à direita
txt_med <- paste0(round(med_perc_plot, 1), "% (", med_tab_plot, ")")
text(x = med_perc_plot, y = bp_med, labels = txt_med, pos = 4, cex = 0.7, font = 2)

# 6. Colocar Legenda no Gráfico
mtext(expression(bold("Gráfico 5 – ") * "Distribuição das diferentes Condições Médicas"),
      side = 1, line = 4)

# Reset das margens
par(mar = c(5, 4, 4, 2))

```

**Exploração** A condição médica mais frequente na amostra é "Hypertension" (17.3%), enquanto "Obesity" apresenta a menor frequência (16.0%). As diferenças observadas entre as várias patologias são reduzidas, sugerindo uma distribuição relativamente equilibrada da carga de doença na amostra analisada.

# Pergunta 3. Compare a variabilidade do número de dias que os pacientes estão internados (obtenha variável secundária a partir da informação disponível na BD) de acordo com o tipo de admissão. 

Foi criada a variável `Days_Stay`, que calcula o período de internamento através da diferença entre a data de alta (`Discharge.Date`) e a data de admissão (`Date.of.Admission`). 

```{r echo=FALSE}

# 1. Criar a variável Days_Stay (assegurando formato numérico e de data)
amostra$Days_Stay <- as.numeric((amostra$Discharge.Date) - (amostra$Date.of.Admission))


# 1.1 Calculo das metricas garantindo que removemos NAs
resumo_p3 <- aggregate(Days_Stay ~ Admission.Type, data = amostra, 
                       function(x) c(m = mean(x, na.rm = TRUE), s = sd(x, na.rm = TRUE)))

# 1.2 Criar o data frame e garantir que os numeros sao numericos
tab_final <- data.frame(
  Admissao = as.character(resumo_p3[, 1]),
  Media = as.numeric(round(resumo_p3[, 2][, "m"], 2)),
  Desvio_Padrao = as.numeric(round(resumo_p3[, 2][, "s"], 2))
)

# 3. Gerar a tabela
knitr::kable(tab_final, col.names = c("Tipo de Admissao", "Media", "Desvio Padrao"),
             caption = "Metricas de Internamento por Tipo de Admissao")
```

Após a criação da variável `Days_Stay` procedeu-se à comparação da sua variabilidade de acordo com o tipo de admissão. As médias do número de dias internados são semelhantes entre os três grupos, situando-se em torno de 15.6 dias. A análise do desvio-padrão evidencia diferenças na variabilidade, sendo o grupo Urgent o que apresenta maior dispersão dos dias de internamento (desvio-padrão de 8.70 dias), seguido dos grupos Emergency e Elective. Estes resultados indicam que, embora a duração média do internamento seja semelhante entre os tipos de admissão, a variabilidade é ligeiramente superior nos casos urgentes.


# Pergunta 4. Compare os boxplots da idade (Age) dos pacientes nas diferentes categorias da condição médica (Medical.Condition).

```{r echo=FALSE}
# 1. Criação do Boxplot de Idade por Condição Médica
ggplot(amostra, aes(x = Medical.Condition, y = Age, fill = Medical.Condition)) +
  # 1.1 Barras horizontais delimitadoras
  stat_boxplot(geom = "errorbar", width = 0.2) + 
  geom_boxplot(alpha = 0.7, outlier.colour = "red") +
  # 1.2 legenda da escala do eixo Y de 10 em 10 anos + texto para titulo, eixos e legenda do gráfico 
  scale_y_continuous(breaks = seq(0, 100, by = 10)) +
  labs(key = "Os números na base indicam o tamanho da amostra (n) por categoria",
       x = "Condição Médica",
       y = "Idade (Anos)",
       caption = bquote(bold("Gráfico 6") ~ "- Boxplot da distribuição 'idade' vs 'Condição médica'")
) +
  #aplicar um tema basico para melhor visualizção e poisção de eixo x e legenda
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.caption = element_text(hjust = 0.5)) +
  scale_fill_brewer(palette = "Set3")
```


Para comparar a distribuição da idade entre as diferentes categorias da condição médica, recorreu-se a boxplots, uma vez que esta representação gráfica permite analisar simultaneamente a mediana, a dispersão (intervalo interquartil) e a presença de valores extremos em cada grupo.
A comparação visual dos boxplots indica que a distribuição etária é abrangente e semelhante entre as diferentes condições médicas. A condição "Arthritis" apresenta a mediana e o terceiro quartil mais elevados, sugerindo uma maior concentração de pacientes em idades mais avançadas. Por outro lado, a condição Asthma evidencia um primeiro quartil mais baixo, indicando a presença de pacientes mais jovens. O intervalo interquartil é visualmente semelhante entre os grupos, assim como os valores mínimos e máximos observados, não se verificando diferenças marcadas na amplitude etária entre as diferentes condições médicas.



# Pergunta 5. Obtenha uma representação gráfica que represente em simultâneo as variáveis Medical.Condition e Admission.Type. 

```{r echo=FALSE}
ggplot(amostra, aes(x = Medical.Condition, fill = Admission.Type)) +
  # geom_bar com position = "dodge" cria as barras lado a lado
  geom_bar(position = position_dodge(preserve = "single")) +
  stat_count(geom = "text", 
             aes(label = after_stat(count)),
             position = position_dodge(width = 0.9), 
             vjust = -0.5,   # Coloca o texto ligeiramente acima da barra
             size = 3.5,     # Tamanho da fonte do N
             fontface = "bold") +
  labs(x = "Condição Médica",
       y = "Número de Pacientes (Frequência)",
       fill = "Tipo de Admissão",
       caption = bquote(bold("Gráfico 7") ~ "- Tipo de Admissão por Condição Médica")
       ) +
  
  theme_minimal() +
  # Inclinamos o texto do eixo X para leitura clara das condições
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  
  # Cores profissionais
  scale_fill_brewer(palette = "Paired")

```

Para representar simultaneamente as variáveis Medical.Condition e Admission.Type, recorreu-se a um gráfico de barras lado a lado, permitindo comparar, para cada condição médica, a distribuição dos diferentes tipos de admissão.
A análise do gráfico indica que, para todas as condições médicas, os três tipos de admissão apresentam frequências semelhantes, não se observando diferenças acentuadas entre categorias. Em algumas patologias, como Hypertension e Cancer, verifica-se uma ligeira predominância das admissões emergentes e urgentes face às eletivas, embora o padrão global sugira uma distribuição relativamente equilibrada dos tipos de admissão entre as diferentes condições médicas.

# Pergunta 6. Para os pacientes que tiveram um resultado inconclusivo durante um teste médico na admissão, caracterize a distribuição do valor faturado pelos serviços de saúde (Billing.Amount)

```{r item6, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 10}
# 1. Garantir a filtragem 
dados_inconclusivos <- subset(amostra, Test.Results == "Inconclusive")

# 2. Filtragem dos dados (apenas resultados inconclusivos)
dados_inconclusivos <- subset(amostra, Test.Results == "Inconclusive")

# 3. Cálculo da média faturada para este grupo
media_val <- mean(dados_inconclusivos$Billing.Amount, na.rm = TRUE)

# 4. Boxplot
boxplot(dados_inconclusivos$Billing.Amount, 
        main="", 
        ylab="Idade",
        col="lightgreen")

# Adicionar a média ao gráfico
abline(h = media_val, col = "red", lwd = 2, lty = 2)
text(x = 1,
     y = media_val + (0.05 * media_val),
     labels = paste0("Mean = ", round(media_val, 2), " $"),
     pos = 3,         
     cex = 0.8,
     col = "black")

# Legenda
mtext(expression(bold("Gráfico 8 — ") * "Valor faturado em pacientes com testes inconclusivos"),
      side = 1, line = 3, cex = 0.9, adj = 0.5)

```


```{r echo=FALSE}
# Cálculo das métricas para a caracterização
summary(dados_inconclusivos$Billing.Amount)
sd(dados_inconclusivos$Billing.Amount) 
```

A distribuição do valor faturado (Billing.Amount) para os pacientes com resultado inconclusivo apresenta uma elevada dispersão, com valores a variarem aproximadamente entre 1 000 e 50 000 unidades monetárias. A média situa-se em torno de 26 114, sendo próxima da mediana (26 201), o que sugere uma distribuição relativamente equilibrada em termos de tendência central.

Para caracterizar a distribuição do valor faturado (Billing.Amount) nos pacientes com resultados inconclusivos, recorreu-se a um boxplot, uma vez que esta representação é adequada para variáveis contínuas com elevada amplitude.
Observa-se uma elevada dispersão dos valores faturados, com um intervalo interquartil amplo e valores mínimos e máximos bastante afastados. A proximidade entre a média e a mediana sugere ausência de assimetria acentuada, não se identificando um patamar de custo dominante associado a episódios com resultados inconclusivos.


# Pergunta 7. Considere os pacientes do sexo masculino e que tomam aspirina ou ibuprofeno e obtenha uma estimativa pontual e intervalar a 98% da média do número de dias internado (variável obtida em 3). 

```{r echo=FALSE}
# 1. Filtragem 
subgrupo_7 <- subset(amostra, 
                     Gender == "Male" & 
                     Medication %in% c("Aspirin", "Ibuprofen"))

n_sub <- nrow(subgrupo_7)

# 2. Inferência com t.test 
res_7 <- t.test(subgrupo_7$Days_Stay, conf.level = 0.98)

# 3. Extração de dados 
m_pontual <- round(res_7$estimate, 2)
ic_inf <- round(res_7$conf.int[1], 2)
ic_sup <- round(res_7$conf.int[2], 2)

# Output
cat("Análise de Inferência:\n")
cat("n =", n_sub, "\n")
cat("Média amostral =", m_pontual, "\n")
cat("IC 98% = [", ic_inf, ";", ic_sup, "]\n")

```

Para os pacientes do sexo masculino que tomam aspirina ou ibuprofeno, procedeu-se à estimação da média do número de dias de internamento. A estimativa pontual da média amostral é de 15.57 dias, obtida a partir de uma amostra com 1063 observações.

Assumindo a independência das observações e recorrendo ao Teorema do Limite Central, foi construído um intervalo de confiança a 98% para a média populacional do número de dias de internamento. O intervalo obtido foi [14.96 ; 16.18] dias, indicando que, com um nível de confiança de 98%, a média populacional se encontra compreendida neste intervalo.

# Pergunta 8. O valor médio do valor faturado para os pacientes do sexo feminino e que tomaram Lipitor é significativamente diferente de 30.000$?

```{r echo=FALSE}
# 1. Filtragem 
subgrupo_8 <- subset(amostra, 
                     Gender == "Female" & 
                     Medication == "Lipitor")

# 2. Execução do Teste t
# mu = 30000 define o valor de comparação
teste_8 <- t.test(subgrupo_8$Billing.Amount, mu = 30000)

# 3. Extração de métricas para o relatório 
p_valor <- teste_8$p.value
t_stat <- round(teste_8$statistic, 2)
n_8 <- nrow(subgrupo_8)
media_8 <- round(teste_8$estimate, 2)

# Formatação do p-value 
p_formatado <- if(p_valor < 0.001) "p < .001" else paste("p =", round(p_valor, 3))

# Output para análise
cat("Média Amostral:", media_8, "\n")
cat("Estatística t:", t_stat, "\n")
cat("n:", n_8, "\n")
cat("p-value:", p_formatado, "\n")

```
Para as pacientes do sexo feminino medicadas com Lipitor (n = 521), procedeu-se à realização de um teste t para uma amostra com o objetivo de avaliar se o valor médio faturado difere do valor de referência de 30 000 €.

A média amostral observada foi de 26 377.31 €. O teste revelou uma diferença estatisticamente significativa relativamente ao valor de referência (t = −5.75, p < .001), indicando que o valor médio faturado neste subgrupo é significativamente diferente de 30 000 €, sendo inferior ao valor considerado.

# Pergunta 9. Verifique se existe alguma associação entre o tipo de sangue e o tipo de admissão.

Para avaliar a existência de uma associação entre o tipo de sangue e o tipo de admissão, recorreu-se a uma tabela de contingência e ao teste do Qui-Quadrado de independência de Pearson.

```{r echo=FALSE}
# 1. Criação de tabela de frequências absolutas
tabela_cruzada <- table(amostra$Blood.Type, amostra$Admission.Type)

# 2. Frequências Relativas 
tabela_prop <- round(prop.table(tabela_cruzada, margin = 1) * 100, 2)

knitr::kable(
  tabela_prop,
  caption = "Tabela de frequncias relativas de tipo de sangue por tipo de admissão"
)
# 3. Teste Qui-Quadrado (Inferência)
teste_qui2 <- chisq.test(tabela_cruzada)

# 4. Output para analise
cat("Tamanho da amostra (n): ", nrow(amostra), "\n")
cat("Estatística Chi-squared:", round(teste_qui2$statistic, 2), "\n")
cat("p-value:", if(teste_qui2$p.value < 0.001) "p < .001" else round(teste_qui2$p.value, 3), "\n")

```

O teste não revelou evidência estatisticamente significativa de associação entre as variáveis (χ² = 14.03, n = 5431, p = .447). Estes resultados indicam que a distribuição do tipo de admissão é semelhante entre os diferentes grupos sanguíneos.

# Pergunta 10. Considerando apenas os pacientes que tiveram os resultados dos exames na admissão normal ou anormal, verifique se existe alguma associação entre o sexo e o resultado do teste. 

Considerando apenas os pacientes com resultados válidos dos exames na admissão (Normal ou Anormal), a análise foi realizada sobre uma amostra de 3682 indivíduos.

```{r echo =FALSE}
# 1. Preparação dos dados
dados_10 <- subset(amostra, Test.Results != "Inconclusive")
dados_10$Test.Results <- droplevels(dados_10$Test.Results)

# 2. Realização do teste
teste_10 <- chisq.test(table(dados_10$Gender, dados_10$Test.Results))

# 3. Output para analise
cat("Dimensão da Amostra (n) =", nrow(dados_10), "\n")
print(teste_10)

# 4. Tabela de Percentagens (Regra 2) para complementar
cat("Distribuição Percentual por Género")
tabela_percent <- round(prop.table(teste_10$observed, margin = 1) * 100, 2)
print(tabela_percent)

```

O teste do Qui-Quadrado de independência de Pearson, com correção de continuidade de Yates, não evidenciou uma associação estatisticamente significativa entre o sexo e o resultado do teste (χ² = 3.31, df = 1, p = .069). As frequências relativas indicam proporções semelhantes de resultados anormais entre homens e mulheres.

# Pergunta 11. Verifique se existe alguma correlação entre a idade e o número de dias internado. Construa o diagrama de dispersão e use cores diferentes para identificar o sexo masculino e feminino.

A relação entre a idade (Age) e o número de dias de internamento (Days_Stay) foi avaliada através do coeficiente de correlação de Pearson, com base numa amostra de 5431 pacientes.
```{r item11, echo=FALSE}
# 1. Realização do Teste de Correlação
# Usamos as variáveis Age e Days_Stay (já criada anteriormente)
teste_cor_11 <- cor.test(amostra$Age, amostra$Days_Stay)
# 2. Output para Analise
cat(" Dimensão da Amostra (n) =", nrow(amostra), "\n")
print(teste_cor_11)

# 3. Construção do Gráfico (Diagrama de Dispersão)
library(ggplot2)
ggplot(amostra, aes(x = Age, y = Days_Stay, color = Gender)) +
  # 1. geom_jitter separa os pontos sobrepostos 
  geom_jitter(alpha = 0.3, size = 1.2, width = 0.5, height = 0.5) +
  # 2. geom_smooth desenha a linha de tendência 
  geom_smooth(method = "lm", color = "black", se = FALSE, linetype = "dashed") +
  # 3. Cores personalizadas
  scale_color_manual(values = c("Female" = "maroon1", "Male" = "dodgerblue3")) +
  labs(title = "",
       subtitle = paste("n =", nrow(amostra), "| Linha tracejada indica tendência linear "),
       x = "Idade (Anos)",
       y = "Dias de Internamento",
       color = "Sexo",
       caption = bquote(bold("Gráfico 9") ~ "- Relação entre Idade e Dias de Internamento")
       ) +
  theme_minimal()
```

O coeficiente de correlação obtido foi r = −0.009, não sendo estatisticamente significativo (p = .499). O diagrama de dispersão, com diferenciação por sexo, não evidencia padrões distintos entre homens e mulheres nem uma tendência linear clara. Assim, não se encontrou evidência estatística de correlação entre a idade e a duração do internamento.

# Pergunta 12. Simule uma variável que represente a Idade para 150 pacientes, com base nas características da Idade desta BD. Compare os resultados obtidos representando no mesmo gráfico as duas distribuições. 

Com base nas características empíricas da variável Age observadas na base de dados original, foi simulada uma amostra de 150 pacientes, assumindo uma distribuição normal parametrizada pela média e pelo desvio-padrão observados.

```{r echo=FALSE}
# 1. Obter parâmetros da idade real
media_idade <- mean(amostra$Age, na.rm = TRUE)
sd_idade <- sd(amostra$Age, na.rm = TRUE)

# 2. Simular 150 pacientes (Reprodutibilidade)
set.seed(123) # Garante que os números aleatórios sejam sempre os mesmos ao correr o código
idade_simulada <- rnorm(150, mean = media_idade, sd = sd_idade)

# 3. Criar um dataframe para comparação
df_real <- data.frame(Idade = amostra$Age, Tipo = "Real (n=5431)")
df_simu <- data.frame(Idade = idade_simulada, Tipo = "Simulada (n=150)")
df_total <- rbind(df_real, df_simu)

# 4. Gráfico de Densidade Sobreposto 
library(ggplot2)
ggplot(df_total, aes(x = Idade, fill = Tipo)) +
  geom_density(alpha = 0.5) +
  scale_fill_manual(values = c("Real (n=5431)" = "gray40", "Simulada (n=150)" = "skyblue")) +
  labs(title = "",
       x = "Idade",
       y = "Densidade",
       fill = "Distribuição",
       caption = bquote(bold("Gráfico 10") ~ "- Comparação de Distribuições: Idade Real vs. Simulada")
       ) +
  theme_minimal()

```
A comparação entre a distribuição real (n = 5431) e a distribuição simulada (n = 150), através da representação conjunta das curvas de densidade, indica que a amostra simulada reproduz adequadamente a forma geral, a posição central e a dispersão da distribuição original. Estes resultados sugerem que os parâmetros estimados descrevem de forma consistente a variável idade, permitindo a geração de dados sintéticos representativos.



# Pergunta 13 - Utilizando a base de dados de que dispõe e proceda a uma análise estatística suplementar elaborando 2 questões e tire as respetivas conclusões.

*13.1 - O tipo de internamento (Admission.Type) influencia o valor faturado (Billing.Amount)?*

Para avaliar se o tipo de admissão influencia o valor faturado, foram agrupados os doentes segundo a categoria de admissão existente na base de dados. Para cada grupo foi calculado o valor faturado médio, bem como o desvio-padrão, de forma a caracterizar a centralidade e a variabilidade dos custos. Posteriormente, foi elaborado um boxplot comparativo entre os diferentes tipos de admissão, incluindo a indicação da proporção que cada categoria representa na amostra e o respetivo número de casos. Este procedimento permite comparar visualmente a distribuição dos valores faturados entre categorias e identificar diferenças ou semelhanças relevantes entre grupos.

#Atenção deixei aqui alterações acrescentei esta tabela bonita!! 

```{r}
# Médias por tipo de admissão
media_adm <- tapply(
  amostra$Billing.Amount,
  amostra$Admission.Type,
  mean,
  na.rm = TRUE
)

# Desvios-padrão por tipo de admissão
sd_adm <- tapply(
  amostra$Billing.Amount,
  amostra$Admission.Type,
  sd,
  na.rm = TRUE
)
# Obter uma tabela 
tabela_13 <- data.frame(
  Tipo_de_Admissao = names(media_adm),
  Media = round(media_adm, 2),
  Desvio_Padrao = round(sd_adm, 2)
)
# organizar tabela 
  knitr::kable(
  tabela_13,
  col.names = c("Tipo de Admissão", "Média (€)", "Desvio-Padrão (€)"),
  caption = "**Tabela 13** – Média e desvio-padrão do valor faturado por tipo de admissão",
  align = "c"
)
```


```{r echo=FALSE}
#1. Obter os valores necessários
#média
tapply(amostra$Billing.Amount,
       amostra$Admission.Type,
       mean)
#Desvio Padrão
tapply(amostra$Billing.Amount,
       amostra$Admission.Type,
       sd)

#2. Obter o gráfico

# aumentar  a margem inferior
par(mar = c(6, 4, 2, 1))  

bp <- boxplot(Billing.Amount ~ Admission.Type,
              data = amostra,
              col = c("lightblue", "lightgreen", "orange"),
              main = "",
              xlab = "Tipo de Admissão",
              ylab = "Valor Faturado ($)")

perc <- prop.table(table(amostra$Admission.Type))[bp$names] * 100
n <- table(amostra$Admission.Type)[bp$names]
y_pos <- bp$stats[4, ] 

text(seq_along(bp$names), y_pos,
     labels = paste0(round(perc,1), "% (n=", n, ")"),
     pos = 3, cex = 0.8)

mtext(expression(bold("Gráfico 11 — ") * "Custo do internamento por tipo de admissão"),
      side = 1, line = 4, cex = 0.9, adj = 0.5)

```

Os resultados evidenciam que os tipos de admissão apresentam valores médios faturados muito semelhantes, mas não totalmente idênticos: aproximadamente 31,7% na admissão eletiva, 34,3% na admissão de emergência e 34% na admissão urgente. Embora a diferença entre categorias seja relativamente pequena, observa-se que a admissão eletiva apresenta um valor médio ligeiramente inferior face às restantes.

*A análise descritiva revela que as médias do valor faturado são relativamente semelhantes entre os diferentes tipos de internamento, situando-se aproximadamente entre 24 600€ e 26 600€. Em todos os grupos observa-se um desvio-padrão elevado, evidenciando uma considerável variabilidade dos custos dentro de cada categoria de admissão.

A observação do boxplot confirma esta elevada dispersão e mostra uma forte sobreposição das distribuições entre os três tipos de internamento. As medianas encontram-se próximas e não se identificam diferenças visuais marcadas ou padrões distintos de faturação associados a um tipo específico de admissão.
Com base na análise descritiva e na comparação gráfica das distribuições, não se observa evidência clara de que o tipo de internamento influencie de forma relevante o valor faturado dos pacientes.*

*13.2 - Qual é a representação das diferentes condições médicas (Medical.Condition) dentro do género Masculino (Male).*

Para responder a esta questão procedeu-se primeiro à filtragem da amostra por género, isolando apenas os indivíduos do sexo masculino. De seguida, foram contabilizadas a frequência absoluta e a frequência relativa de cada condição médica presente nesse subconjunto. Com base nesses valores, construiu-se um gráfico de barras horizontais que apresenta, para cada condição, o número de casos e a respetiva percentagem dentro do grupo masculino, permitindo uma comparação visual da predominância relativa das diferentes patologias nesta amostra.
*Para responder a esta questão, procedeu-se à filtragem da amostra por género, considerando apenas os indivíduos do sexo masculino. De seguida, foram calculadas as frequências absolutas e relativas de cada condição médica neste subgrupo. Com base nestes valores, construiu-se um gráfico de barras horizontal, que apresenta, para cada condição, o número de casos e a respetiva percentagem dentro da população masculina, permitindo uma comparação visual da prevalência relativa das diferentes patologias.*

```{r echo=FALSE}
# Calcular os valores necessários
sub_amostra <- amostra[amostra$Gender == "Male", ]

freq <- table(sub_amostra$Medical.Condition)

perc <- prop.table(freq) * 100


# Gráfico

# mais espaço à esquerda
par(mar = c(7, 10, 4, 2))     
par(cex = 0.75, xpd = NA)

cores <- c("Green", "Orange", "Violet","SkyBlue", "Goldenrod", "Tomato")
lim_x <- max(freq) * 1.1
bp <-barplot(freq,
              horiz = TRUE,
              col = cores,
              main = "",
              xlab = "",
              ylab = "",
              las = 1,
              names.arg = NA,    
              cex.names = 0.75,
              xlim = c(0, lim_x))


# Percentagens + n
text(x = freq,
     y = bp,
     labels = paste0(round(perc, 1), "% (n=", freq, ")"),
     pos = 4,
     cex = 0.8)

# nomes
text(x = par("usr")[1] - 0.05 * diff(par("usr")[1:2]),  
     y = bp,
     labels = names(freq),
     srt = 45,         
     adj = 1,           
     xpd = TRUE,
     cex = 0.9)         

# Legenda
mtext(expression(bold("Gráfico 12 — ") * "Distribuição das condições médicas (sexo masculino)"),
      side = 1, line = 4.7, adj = 0.5, cex = 0.85)  

mtext("Condições médicas", side = 2, line = 8, cex = 1.0) 
mtext("n", side = 1, line = 3.4, cex = 1)


```
A análise gráfica das condições médicas na amostra de pacientes do sexo masculino evidencia que a hipertensão e a artrite são as condições mais frequentes, representando 17,3% e 17,4% da amostra, respetivamente. Em contraste, a obesidade surge como a condição médica menos frequente, correspondendo a 15,2% dos casos observados. Estes resultados indicam uma distribuição relativamente equilibrada das condições médicas na amostra masculina, embora se verifique uma ligeira predominância da artrite e da hipertensão face às restantes patologias.


*A análise gráfica evidencia que as condições médicas mais frequentes entre os pacientes do sexo masculino são Arthritis (17,4%) e Hypertension (17,3%), apresentando proporções muito semelhantes. Seguem-se Asthma (16,8%), Diabetes (16,7%) e Cancer (16,6%), com valores igualmente próximos entre si. A condição menos frequente é Obesity, representando 15,2% dos casos observados neste subgrupo. A distribuição das condições médicas na amostra masculina revela um padrão relativamente equilibrado, sem predominância marcada de uma patologia específica. As diferenças observadas entre as categorias são pequenas, indicando que, dentro do género masculino, as diversas condições médicas apresentam prevalências semelhantes, ainda que com uma ligeira predominância de artrite e hipertensão. Na população masculina analisada, as diferentes condições médicas apresentam uma distribuição globalmente equilibrada, destacando-se marginalmente a artrite e a hipertensão como as patologias mais frequentes, e a obesidade como a menos representada.*






